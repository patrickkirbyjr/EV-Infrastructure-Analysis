---
title: "EV Project"
output: html_notebook
---

Executive Summary

The goal of this project is to determine the states that are most in need of electric vehicle stations based on a number of factors.
These factors include the current number of stations, number of electric vehicle registrations, and state population.
Results from this project should identify the states most in need of adding electric vehicle charging stations.

---

import libraries and dataset

```{r}

library(tidyverse)
library(dplyr)
library(janitor)
library(Hmisc)
library(ggplot2)

alt_fuel_stations <- read_csv("alt_fuel_stations (Jul 7 2025).csv")
alt_fuel_stations
```

set random state seed

```{r}
set.seed(42)
```


clean columns names using janitor

```{r}
alt_fuel_stations_clean <- clean_names(alt_fuel_stations)

alt_fuel_stations_clean
```

filter to only EV stations ("ELEC")

```{r}
ev_stations <- filter(alt_fuel_stations_clean, fuel_type_code == "ELEC")

ev_stations
```

take a look at the values

```{r}
summary(ev_stations)
```

select columns for study (simple set at first)
goal: where are the stations, how many of them are there per state

```{r}
ev_stations_selected <- ev_stations |>
  select(station_name, city, state, zip, country, latitude, longitude, ev_network)

ev_stations_selected
```

look at selected columns

```{r}
summary(ev_stations_selected)

```

check for missing values

```{r}
sum(is.na(ev_stations_selected))
```

now, just US market 

```{r}
ev_stations_us <- filter(ev_stations_selected, country == "US")
ev_stations_us
```

look at different networks (checking for Tesla and Electrify America)

```{r}
ev_networks <- ev_stations_us[ ,"ev_network"]
table(ev_networks)
```
breakdown by state

```{r}
ev_stations_by_state <- ev_stations_us |>
  group_by(state) |>
  summarise(total_stations = n()) |>
  arrange(desc(total_stations))

ev_stations_by_state
```

for plotting (top 10 only)

```{r}
ev_stations_by_state_10 <- ev_stations_us |>
  group_by(state) |>
  summarise(total_stations = n()) |>
  arrange(desc(total_stations)) |>
  head(10)
```


time to plot

```{r}

ggplot(ev_stations_by_state_10, aes(x = reorder(state, -total_stations), y = total_stations)) + 
  geom_bar(stat = "identity", fill = "steelblue") +
  labs(
    title = "Top 10 States by Total EV Stations",
    x = "State",
    y = "EV Stations"
  ) + 
  geom_text(aes(label = total_stations), vjust = -0.2)
```

visualize US charging stations

```{r}
library(maps)

ggplot(ev_stations_us, aes(x = longitude, y = latitude)) +
  borders("state") +
  geom_point(alpha = 0.2, color = "green", size = 0.3) +
  coord_fixed(1.3) + 
  labs(title = "US EV Charging Stations")
```
import data on number of vehicle registrations by state

```{r}
ev_registrations <- read_csv("ev_registration_by_state.csv")
ev_registrations <- clean_names(ev_registrations)
ev_registrations

```

drop total and DC rows

```{r}
ev_registrations_50 <- ev_registrations[!(ev_registrations$state) %in% c("District of Columbia", "Total"),]
ev_registrations_50
```

change state names to abbreviations

```{r}
ev_registrations_50$state <- state.abb[match(ev_registrations_50$state, state.name)]
ev_registrations_50
```

compare total number of ev stations to number of registrations by joining on state
drop PR and DC

```{r}
ev_combined <- ev_stations_by_state |>
  left_join(ev_registrations_50)

ev_combined <- ev_combined[!(ev_combined$state) %in% c("PR", "DC"),]

ev_combined
```

sort by state

```{r}
ev_combined <- ev_combined |>
  arrange(ev_combined$state)

ev_combined
```

add in population information

```{r}
state_populations <- read_csv("state_populations.csv")
state_populations
```

change state names to abbreviations, again

```{r}
state_populations$state <- state.abb[match(state_populations$state, state.name)]
state_populations
```

join population data to existing combined dataset

```{r}
ev_combined_pop <- ev_combined |>
  left_join(state_populations)

ev_combined_pop 
```

begin simple analysis
goal: calculate electric vehicles per station for each state

```{r}
ev_combined_pop <- ev_combined_pop |>
  mutate(evs_per_station = round(registration_count / total_stations, 2)) |>
  arrange(desc(evs_per_station))

ev_combined_pop
```

goal: calculate number of people per station based on population

```{r}
ev_combined_pop <- ev_combined_pop |>
  mutate(people_per_station = round(population / total_stations, 2)) |>
  arrange(desc(people_per_station))

ev_combined_pop
```

goal: calculate percentage of population with an EV

```{r}
ev_combined_pop <- ev_combined_pop |>
  mutate(pop_with_ev = round(registration_count / population, 4)) |>
  arrange(desc(pop_with_ev))

ev_combined_pop
```

visualize with heat maps

```{r}
library(usmap)

plot_usmap(data = ev_combined_pop, values = "evs_per_station", color = "white") + 
  scale_fill_viridis_c(option = "C") +
  labs(title = "EVs Per Charging Station in the US",
       fill = "EVs/Station")

ggsave("evs_per_charging_station_us.png", bg = "grey")

```

```{r}
plot_usmap(data = ev_combined_pop, values = "people_per_station", color = "white") + 
  scale_fill_viridis_c(option = "C") +
  labs(title = "People Per Charging Station in the US",
       fill = "People/Station")

ggsave("people_per_charging_station_us.png", bg = "grey")

```

```{r}
plot_usmap(data = ev_combined_pop, values = "pop_with_ev", color = "white") + 
  scale_fill_viridis_c(option = "C") +
  labs(title = "EV Saturation by Population",
       fill = "EV Reg / Pop")

ggsave("ev_saturation_by_population.png", bg = "grey")

```

predictive linear modeling based on registrations and population

```{r}
model_lm = lm(total_stations ~ registration_count + population, data = ev_combined_pop)
summary(model_lm)
```

predict stations based on model
expected stations = stations the model predicts should exist
station gap = difference between expected stations and current stations

```{r}
model <- model_lm

ev_combined_pop <- ev_combined_pop |>
  mutate(expected_stations = round(predict(model), 0),
         station_gap = expected_stations - total_stations) |>
  arrange(desc(station_gap))

ev_combined_pop
```

visualize station gap

```{r}
plot_usmap(data = ev_combined_pop, values = "station_gap", color = "white") + 
  scale_fill_gradient2(
    low = "blue", mid = "white", high = "red",
    midpoint = 0, name = "Station Gap"
  ) +
  labs(
    title = "EV Charging Station Gaps by State",
    subtitle = "Red = Underbuilt, Blue = Overbuilt"
  )

ggsave("ev_charging_station_gaps_by_state.png", bg = "grey")
```

```{r}
ev_combined_pop_10 <- ev_combined_pop |>
  head(10)

ggplot(ev_combined_pop_10, aes(x = reorder(state, -station_gap), y = station_gap)) + 
  geom_bar(stat = "identity", fill = "steelblue") +
  labs(
    title = "Top 10 Underbuilt EV States",
    x = "State",
    y = "Station Gap"
  ) + 
  geom_text(aes(label = station_gap), vjust = -0.2)

ggsave("top_10_underbuilt_states.png")
```
 
---

Conclusion

This project sought to identify the states in most need of electric vehicle infrastructure build out.  








